<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ruleta Shenlong</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: green;
      font-family: Arial, sans-serif;
    }
    #ruleta-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100vh;
      position: relative;
    }
    #ruleta-wrapper {
      position: relative;
      width: 600px;
      height: 600px;
      max-width: 90vw;
      max-height: 90vw;
    }
    #ruleta-canvas {
      width: 100%;
      height: 100%;
      background: transparent;
    }
    #big-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      transform-origin: center;
      width: 60vw;
      height: auto;
      transition: transform 1s ease;
      z-index: 3;
      cursor: pointer;
    }
    #big-logo.shrink {
      transform: translate(-50%, -50%) scale(0.2);
    }
    #resultado {
      font-size: 3rem;
      color: yellow;
      text-shadow: 2px 2px 4px black;
      margin-top: 30px;
      display: none;
    }
    #btnRepetir {
      margin-top: 20px;
      padding: 15px 30px;
      font-size: 1.3rem;
      cursor: pointer;
      display: none;
      background: linear-gradient(45deg, #f39c12, #f1c40f);
      color: #fff;
      border: none;
      border-radius: 10px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }
    #btnRepetir:hover {
      transform: scale(1.05);
      box-shadow: 3px 3px 7px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>

<div id="ruleta-container">
  <div id="ruleta-wrapper">
    <canvas id="ruleta-canvas"></canvas>
    <img id="big-logo"
         src="https://raw.githubusercontent.com/SnchzBroz/shenglong/main/Nuevo%20Logo.png"
         alt="Logo Shenlong">
  </div>
  <div id="resultado"></div>
  <button id="btnRepetir">Repetir</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>

<script>
const ruletaWrapper = document.getElementById('ruleta-wrapper');
const ruletaCanvas  = document.getElementById('ruleta-canvas');
const ctx           = ruletaCanvas.getContext('2d');
const bigLogo       = document.getElementById('big-logo');
const resultadoDiv  = document.getElementById('resultado');
const btnRepetir    = document.getElementById('btnRepetir');

const opciones = [
  "Opción 1","Opción 2","Opción 3","Opción 4","Opción 5",
  "Opción 6","Opción 7","Opción 8","Opción 9","Opción 10"
];
const numOpciones   = opciones.length;
const anguloSeccion = 360 / numOpciones;

let anguloActual  = 0;
let velocidadGiro = 0;
let girando       = false;
let animacionFrame;
let startTime     = 0;
let randomSpinTime = 0;

const audioSanchezBroz = new Audio("https://raw.githubusercontent.com/SnchzBroz/shenglong/main/sanchezbroz.mp3");
const sonidoGiro       = new Audio("https://www.soundjay.com/buttons/button-3.mp3");
const drumMusic        = new Audio("https://www.fesliyanstudios.com/play-mp3/387"); // Ejemplo tambores
drumMusic.loop = true;

function dibujarRuleta() {
  const w = ruletaCanvas.width  = ruletaWrapper.offsetWidth;
  const h = ruletaCanvas.height = ruletaWrapper.offsetHeight;
  const cx = w / 2;
  const cy = h / 2;
  const r  = Math.min(cx, cy) - 10;
  ctx.clearRect(0, 0, w, h);
  for (let i = 0; i < numOpciones; i++) {
    const angInicio = (anguloSeccion*i + anguloActual) * Math.PI/180;
    const angFin    = (anguloSeccion*(i+1)+ anguloActual) * Math.PI/180;
    ctx.fillStyle = (i % 2 === 0) ? "#f1c40f" : "#e67e22";
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, angInicio, angFin);
    ctx.closePath();
    ctx.fill();
    ctx.save();
    ctx.fillStyle = "#000";
    ctx.translate(cx, cy);
    ctx.rotate((angInicio + angFin)/2);
    ctx.textAlign = "right";
    ctx.font = "bold 18px sans-serif";
    ctx.fillText(opciones[i], r - 10, 5);
    ctx.restore();
  }
}

function actualizarRuleta(timestamp) {
  if (!startTime) {
    startTime = timestamp;
  }
  const elapsed = (timestamp - startTime) / 1000;
  anguloActual += velocidadGiro;
  anguloActual %= 360;

  if (elapsed >= randomSpinTime) {
    velocidadGiro *= 0.98;
  }
  if (velocidadGiro > 1 && sonidoGiro.paused) {
    sonidoGiro.currentTime = 0;
    sonidoGiro.play().catch(()=>{});
  }
  if (velocidadGiro < 0.3) {
    velocidadGiro = 0;
    girando = false;
    cancelAnimationFrame(animacionFrame);
    drumMusic.pause();
    sonidoGiro.pause();
    sonidoGiro.currentTime = 0;
    const anguloFinal = (anguloActual + 360) % 360;
    const arrowAngle  = (360 - anguloFinal) % 360;
    const index = Math.floor((arrowAngle + anguloSeccion/2) / anguloSeccion) % numOpciones;
    resultadoDiv.innerText = "¡Ganaste: " + opciones[index] + "!";
    resultadoDiv.style.display = 'block';
    lanzarConfeti();
    setTimeout(() => {
      audioSanchezBroz.play().catch(()=>{});
    }, 1000);
    btnRepetir.style.display = 'inline-block';
    return;
  }
  dibujarRuleta();
  animacionFrame = requestAnimationFrame(actualizarRuleta);
}

function girarRuleta() {
  if (girando) return;
  girando = true;
  resultadoDiv.style.display = 'none';
  btnRepetir.style.display   = 'none';
  sonidoGiro.pause();
  sonidoGiro.currentTime = 0;
  startTime = 0;
  randomSpinTime = 3 + Math.random() * 3; 
  velocidadGiro = 12;
  drumMusic.currentTime = 0;
  drumMusic.play().catch(()=>{});
  animacionFrame = requestAnimationFrame(actualizarRuleta);
}

bigLogo.addEventListener('click', () => {
  if (bigLogo.classList.contains('shrink')) return;
  bigLogo.classList.add('shrink');
  bigLogo.addEventListener('transitionend', () => girarRuleta(), { once:true });
});

btnRepetir.addEventListener('click', () => {
  anguloActual  = 0;
  velocidadGiro = 0;
  dibujarRuleta();
  resultadoDiv.style.display = 'none';
  btnRepetir.style.display   = 'none';
  bigLogo.classList.remove('shrink');
  void bigLogo.offsetWidth;
});

window.addEventListener('load', () => {
  dibujarRuleta();
});
function lanzarConfeti() {
  const duration = 2000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({
      particleCount: 5,
      angle: Math.random()*60 + 160,
      spread: 55,
      origin: {
        x: Math.random(),
        y: Math.random()-0.2
      }
    });
    if (Date.now() < end) {
      requestAnimationFrame(frame);
    }
  })();
}
</script>

</body>
</html>
